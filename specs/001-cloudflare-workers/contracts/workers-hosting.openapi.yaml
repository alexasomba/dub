openapi: 3.1.2
info:
  title: Dub Workers Hosting - Operational Endpoints
  version: 0.1.0
  description: |
    Operational endpoints intended for self-hosted deployments of Dub on Cloudflare Workers.
    These endpoints support deployment validation and troubleshooting.
servers:
  - url: https://{host}
    variables:
      host:
        default: example.com
paths:
  /api/health:
    get:
      summary: Basic health check
      description: Returns process-level health and minimal runtime info.
      responses:
        "200":
          description: Healthy
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required: [status]
                properties:
                  status:
                    type: string
                    enum: [ok]
                  runtime:
                    type: string
                    description: Runtime identifier (workers)
        "500":
          description: Unhealthy
  /api/_internal/compat:
    get:
      summary: Compatibility report
      description: |
        Returns a compatibility matrix snapshot for the current deployment.
        Intended for operators; may be protected in production.
      parameters:
        - in: header
          name: X-Operator-Token
          required: false
          schema:
            type: string
          description: Operator token required when the endpoint is enabled.
      responses:
        "200":
          description: Compatibility report
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required: [runtime, contractVersion, integrations]
                properties:
                  runtime:
                    type: string
                    enum: [workers]
                  contractVersion:
                    type: string
                    description: OpenAPI contract version
                  integrations:
                    type: object
                    additionalProperties:
                      type: object
                      additionalProperties: true
                      required: [status]
                      properties:
                        status:
                          type: string
                          enum: [supported, replaced, disabled]
                        replacement:
                          type: string
                          nullable: true
                        notes:
                          type: string
                          nullable: true

        "404":
          description: Not found (endpoint disabled or operator token missing/invalid)
